## نظرة عامة

هذا المشروع هو بوابة ويب حكومية ثابتة مبنية باستخدام Next.js (App Router)، صُممت لتكون بسيطة، آمنة، وسهلة الصيانة. تم تنظيمها بحيث يمكن لمطورين آخرين الاستمرار في تطويرها وتحديثها مستقبلاً دون تعقيد كبير في البنية.

## نمط المعمارية

- **Component-Driven Clean Architecture**
- **Static App Shell Architecture**

تعني هذه المعمارية أن التطبيق مبني حول مكوّنات UI صغيرة وواضحة المسؤولية، مرتبة في طبقات بسيطة ونظيفة، مع فصل ما بين واجهة المستخدم والمنطق التقني المساعد. تم اختيار هذا الأسلوب لأنه:
- يسهل فهم الشيفرة وتتبّع التغيير.
- يقلّل الاعتماد على خادم خلفي (Backend) وقت التشغيل.
- يتيح إعادة استخدام المكوّنات عبر أجزاء واجهة مختلفة.

Static App Shell تعني أن هيكل الصفحة الرئيسي (Layout + AppShell) ثابت ويتم توليد HTML في وقت البناء أو بشكل ثابت، بينما يتم فقط تهيئة السلوك التفاعلي على المتصفح، مع دعم PWA ووضع عدم الاتصال.

## المبادئ الأساسية

- **Static-first**: لا يوجد Backend وقت التشغيل، ويتم تقديم صفحات ثابتة قدر الإمكان.
- **فصل المسؤوليات**: كل مجلد ومكوّن له دور واضح ومحدد.
- **Server Components**: لتوليد HTML ثابت ونظيف وأسرع في التحميل.
- **Client Components**: فقط لطبقة واجهة المستخدم التفاعلية (تبديل الثيم، الحوارات، الحالة).
- **Offline-first (PWA)**: التطبيق يعمل حتى عند ضعف أو انقطاع الاتصال.
- **Government-grade UI**: واجهة منضبطة، هادئة، وواضحة تخدم السياق الحكومي الرسمي.

## هيكل المشروع ومسؤوليات المجلدات

بنية المجلدات (مبسطة):

```
src/
├─ app/
├─ components/
│  ├─ layout/
│  ├─ branding/
│  ├─ cards/
│  ├─ status/
│  └─ icons/
├─ config/
├─ hooks/
├─ lib/
└─ types/
```

### مجلد `app/`

- يحتوي على `layout.tsx` و `page.tsx` وبقية ملفات App Router.
- `layout.tsx` و `page.tsx` يتم التعامل معهما كـ Server Components قدر الإمكان، حتى يتم توليد HTML ثابت على الخادم أو وقت البناء.
- هذا يضمن:
  - سرعة تحميل أعلى.
  - تحسين SEO.
  - بساطة في التحكم في الهيكل العام للصفحة.

### مجلد `components/`

المكوّنات مقسّمة حسب المسؤولية، وليس فقط حسب النوع:

- `layout/`: مكوّنات الهيكل العام (مثل AppShell، Header، عناصر الإطار العام للتطبيق).
- `branding/`: مكوّنات الهوية البصرية (الشعار، عنوان الوزارة… إلخ).
- `cards/`: مكوّنات عرض الروابط كبطاقات وروابط مجمعة.
- `status/`: مكوّنات حالة النظام (الاتصال، الوضع غير المتصل، شريط الحالة، تبديل الثيم).
- `icons/`: أيقونات SVG معبّأة كمكوّنات React قابلة لإعادة الاستخدام.

هذا التقسيم يسهل إضافة أو تعديل أجزاء الواجهة دون التأثير على بقية النظام.

### مجلد `icons/`

- يحتوي على مكوّنات SVG منفصلة لكل أيقونة.
- الهدف هو:
  - إعادة استخدام الأيقونات في أكثر من مكان.
  - توحيد الأسلوب البصري.
  - تسهيل استبدال أيقونة أو تعديلها في مكان واحد فقط.

### مجلد `config/`

- يحتوي على ملفات إعدادات وتكوين مثل:
  - إعدادات التطبيق العامة.
  - تعريف مجموعات الروابط.
- هذا الفصل يسمح بتعديل البيانات (مثل الروابط والعناوين) دون لمس منطق الواجهة أو المكوّنات.

### مجلد `hooks/`

- يحتوي على Hooks مخصّصة (مثل مراقبة حالة الشبكة).
- الهدف هو:
  - تجميع منطق الحالة المتكررة في مكان واحد.
  - إعادة استخدامه عبر المكوّنات المختلفة دون تكرار الشيفرة.

### مجلد `lib/`

- يضم الأدوات التقنية (Utilities) مثل:
  - شيفرة تسجيل Service Worker وملفات PWA.
  - دوال مساعدة عامة (مثل تنسيقات CSS، أو دوال مشتركة).
- هذا المجلد مخصص للمنطق غير المرتبط مباشرة بالـ UI، ولكن يدعمها تقنياً.

### مجلد `types/`

- يحتوي على أنواع TypeScript المشتركة (مثل نوع الرابط).
- الهدف هو توحيد عقود البيانات وتقليل الأخطاء بين المكوّنات والطبقات.

## مسؤولية AppShell

- `AppShell` هو غلاف تقني للتطبيق، وليس مسؤولاً عن التصميم التفصيلي أو محتوى الصفحات.
- مسؤولياته الأساسية:
  - تهيئة وتسجيل Service Worker.
  - تركيب (Mount) مكوّنات الحالة العامة مثل:
    - مؤشرات الاتصال/انقطاع الاتصال.
    - شريط الحالة أو التنبيهات العمومية.
- تصميم الصفحات والتخطيط التفصيلي يبقى داخل مكوّنات أخرى في `layout/` وداخل `page.tsx`.

## نظام الثيم (الوضع الفاتح/الداكن)

- يعتمد المشروع على `next-themes` لإدارة ثيم الواجهة.
- يعمل الثيم بطريقتين معاً:
  - احترام تفضيل النظام (System Preference) تلقائياً.
  - السماح للمستخدم بالتبديل اليدوي بين الوضعين الفاتح والداكن عبر مكوّن تبديل الثيم.
- تمت مراعاة مشكلة وميض الثيم (FOUC) بحيث:
  - يتم تطبيق الثيم الصحيح مبكراً قدر الإمكان.
  - لا يرى المستخدم تبدل ألوان مزعج عند تحميل الصفحة.

## استراتيجية PWA ووضع عدم الاتصال

- يقوم Service Worker بـ:
  - تخزين الملفات الثابتة الهامة (HTML، CSS، JS، الأيقونات) في الذاكرة المؤقتة (Cache).
  - تقديم هذه الملفات من الكاش أولاً (Cache-first) لضمان عمل التطبيق بسرعة وبدون اتصال.
- يتم استخدام إصدار (Version) للكاش:
  - عند تغيير الإصدار، يتم إنشاء كاش جديد وحذف القديم بأمان.
  - هذا يضمن أن التحديثات تصل للمستخدم دون كسر التجربة أثناء الاستخدام.

## فلسفة التصميم

- واجهة "حكومية" هادئة:
  - ألوان هادئة وواضحة، بدون ازدحام بصري.
  - تدرجات بسيطة وتباين مقروء للنصوص.
- التحريك والأنيميشن:
  - حركات خفيفة ومحدودة، فقط لدعم الفهم وليس للزخرفة.
- دعم الوصولية و RTL:
  - دعم اتجاه الكتابة من اليمين لليسار بشكل افتراضي.
  - الحفاظ على قابلية القراءة واستخدام الواجهة لشرائح واسعة من المستخدمين.

## كيفية توسيع المشروع

- **إضافة روابط جديدة**:
  - يتم تعديل أو إضافة البيانات في ملفات `config/` الخاصة بالروابط، بحيث تظهر تلقائياً في واجهة البطاقات دون تعديل منطق العرض.
- **تحديث الأيقونات**:
  - إضافة أو تعديل مكوّن أيقونة جديد في `components/icons/` ثم استخدامه في المكوّنات المناسبة.
- **تغيير ألوان الثيم**:
  - تحديث إعدادات Tailwind أو متغيرات CSS/الثيم في ملفات التصميم العامة، مع الحفاظ على تباين كافٍ للقراءة.
- **رفع إصدار الكاش (Cache Version)**:
  - تعديل قيمة إصدار الكاش في ملفات PWA/Service Worker في `lib` أو `public/sw.js` بحسب طريقة الإعداد.
  - تشغيل عملية البناء لتوزيع الإصدار الجديد، مما يجبر المتصفحات على استخدام الكاش المحدّث بأمان.


